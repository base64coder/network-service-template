# Frameworkæ¨¡å—ä»£ç åˆ†ææŠ¥å‘Š

## ğŸ”´ ä¸¥é‡é—®é¢˜ï¼šé‡å¤å®ç°

### 1. ä¸‰å¥—IoCå®¹å™¨å®ç°ï¼ˆä¸¥é‡é‡å¤ï¼‰

é¡¹ç›®ä¸­å­˜åœ¨**ä¸‰å¥—å®Œå…¨ç‹¬ç«‹çš„IoCå®¹å™¨å®ç°**ï¼ŒåŠŸèƒ½é«˜åº¦é‡å¤ï¼š

#### å®ç°1: `core/src/main/java/com/dtc/core/framework/ioc/`
- **åŒ…å**: `com.dtc.core.framework.ioc`
- **ç‰¹ç‚¹**: æœ€æ–°å®ç°ï¼ŒåŒ…å«ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–
- **æ ¸å¿ƒç±»**:
  - `DefaultListableBeanFactory` - ä¸‰çº§ç¼“å­˜å®ç°
  - `AnnotationConfigApplicationContext`
  - `BeanDefinition` (ç®€åŒ–ç‰ˆ)

#### å®ç°2: `framework/ioc-core/`
- **åŒ…å**: `com.dtc.ioc.core`
- **ç‰¹ç‚¹**: æ›´å®Œæ•´çš„å®ç°ï¼ŒåŒ…å«BeanContainerã€Environmentç­‰
- **æ ¸å¿ƒç±»**:
  - `DefaultConfigurableBeanFactory`
  - `DefaultBeanContainer`
  - `DefaultNetworkApplicationContext`
  - `AnnotationConfigApplicationContext` (ç»§æ‰¿è‡ªDefaultNetworkApplicationContext)

#### å®ç°3: `framework/beans/`
- **åŒ…å**: `com.dtc.framework.beans`
- **ç‰¹ç‚¹**: ä¸ioc-coreå‡ ä¹å®Œå…¨é‡å¤
- **æ ¸å¿ƒç±»**:
  - `DefaultConfigurableBeanFactory`
  - `DefaultBeanContainer`
  - `DefaultNetworkApplicationContext`
  - `AnnotationConfigApplicationContext`

**é—®é¢˜å½±å“**:
- âŒ ä»£ç é‡å¤ç‡æé«˜ï¼ˆä¼°è®¡>80%ï¼‰
- âŒ ç»´æŠ¤æˆæœ¬é«˜ï¼Œä¿®æ”¹éœ€è¦åŒæ­¥ä¸‰å¤„
- âŒ å¼€å‘è€…å›°æƒ‘ï¼Œä¸çŸ¥é“åº”è¯¥ä½¿ç”¨å“ªä¸€å¥—
- âŒ ä¾èµ–å…³ç³»æ··ä¹±ï¼ˆcoreä¾èµ–ioc-coreï¼Œä½†è‡ªå·±åˆå®ç°äº†ä¸€å¥—ï¼‰

---

### 2. é‡å¤çš„æ³¨è§£å®šä¹‰

#### æ³¨è§£å®šä¹‰ä½ç½®1: `core/src/main/java/com/dtc/core/framework/ioc/annotation/`
- `@Component`
- `@Inject`
- `@Scope`
- `@Configuration`
- `@Bean`
- `@PostConstruct`
- `@PreDestroy`
- `@Conditional`
- `@ConditionalOnClass`
- `@ConditionalOnMissingBean`
- `@ConfigurationProperties`

#### æ³¨è§£å®šä¹‰ä½ç½®2: `framework/annotations/src/main/java/com/dtc/annotations/ioc/`
- `@Component`
- `@Autowired` (å¯¹åº”@Inject)
- `@Service`
- `@Repository`
- `@Value`
- `@PostConstruct`
- `@PreDestroy`

**é—®é¢˜å½±å“**:
- âŒ ä¸¤å¥—æ³¨è§£ç³»ç»Ÿï¼Œå‘½åä¸ä¸€è‡´ï¼ˆ@Inject vs @Autowiredï¼‰
- âŒ åŠŸèƒ½é‡å¤ï¼ˆ@Componentåœ¨ä¸¤ä¸ªåœ°æ–¹éƒ½æœ‰ï¼‰
- âŒ å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶å†²çª

---

### 3. é‡å¤çš„ApplicationContextå®ç°

å‘ç°**è‡³å°‘3ä¸ª**`AnnotationConfigApplicationContext`ç±»ï¼š

1. `core/src/main/java/com/dtc/core/framework/ioc/context/AnnotationConfigApplicationContext.java`
2. `framework/ioc-core/src/main/java/com/dtc/ioc/core/context/AnnotationConfigApplicationContext.java`
3. `framework/beans/src/main/java/com/dtc/framework/beans/context/AnnotationConfigApplicationContext.java`

**é—®é¢˜**: ç±»åç›¸åŒä½†å®ç°ä¸åŒï¼Œå®¹æ˜“é€ æˆæ··æ·†ã€‚

---

## ğŸŸ¡ è®¾è®¡é—®é¢˜

### 4. ç©ºç›®å½•æœªä½¿ç”¨

- `framework/ioc-scanner/` - ç©ºç›®å½•ï¼Œæ— ä»£ç 
- `framework/ioc-lifecycle/` - ç©ºç›®å½•ï¼Œæ— ä»£ç 

**å»ºè®®**: åˆ é™¤æˆ–å¡«å……åŠŸèƒ½

---

### 5. åŒ…åä¸ä¸€è‡´

ä¸‰å¥—å®ç°ä½¿ç”¨ä¸åŒçš„åŒ…åï¼š
- `com.dtc.core.framework.ioc.*`
- `com.dtc.ioc.core.*`
- `com.dtc.framework.beans.*`

**é—®é¢˜**: ç¼ºä¹ç»Ÿä¸€çš„å‘½åè§„èŒƒ

---

### 6. ä¾èµ–å…³ç³»æ··ä¹±

**core/pom.xml**:
```xml
<dependency>
    <groupId>com.dtc</groupId>
    <artifactId>ioc-core</artifactId>
    <version>${project.version}</version>
</dependency>
```

ä½†`core`æ¨¡å—åˆè‡ªå·±å®ç°äº†ä¸€å¥—IoCï¼ˆ`core/src/main/java/com/dtc/core/framework/ioc/`ï¼‰ï¼Œå¯¼è‡´ï¼š
- åŒæ—¶å­˜åœ¨ä¸¤å¥—IoCå®ç°
- ä¸æ¸…æ¥šåº”è¯¥ä½¿ç”¨å“ªä¸€å¥—
- å¯èƒ½é€ æˆç±»åŠ è½½å†²çª

---

### 7. framework/ioc-core å’Œ framework/beans å‡ ä¹å®Œå…¨é‡å¤

é€šè¿‡ä»£ç å¯¹æ¯”å‘ç°ï¼š
- `framework/ioc-core` å’Œ `framework/beans` çš„ç±»ç»“æ„å‡ ä¹ä¸€æ¨¡ä¸€æ ·
- åŒ…åä¸åŒä½†åŠŸèƒ½ç›¸åŒ
- è¿™æ˜¯æœ€ä¸¥é‡çš„é‡å¤

**å»ºè®®**: åˆ é™¤å…¶ä¸­ä¸€ä¸ªæ¨¡å—

---

## ğŸŸ¢ é€»è¾‘é—®é¢˜

### 8. AOPå®ç°ä¸­çš„æ½œåœ¨é—®é¢˜

`framework/aop/src/main/java/com/dtc/framework/aop/aspect/AfterMethodInterceptor.java`:
- ç¬¬66è¡Œï¼šå¼•ç”¨äº†`com.dtc.framework.aop.aspects.JoinPoint`ï¼Œä½†å®é™…åº”è¯¥ä½¿ç”¨`com.dtc.framework.aop.aspect.JoinPoint`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- å‚æ•°è§£æé€»è¾‘å¯èƒ½ä¸å®Œæ•´ï¼ˆåªå¤„ç†äº†JoinPointç±»å‹ï¼‰

---

## ğŸ“‹ ä¿®å¤å»ºè®®

### ä¼˜å…ˆçº§1ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

1. **ç»Ÿä¸€IoCå®ç°**
   - ä¿ç•™ä¸€å¥—æœ€å®Œæ•´çš„å®ç°ï¼ˆå»ºè®®ä¿ç•™`framework/ioc-core`ï¼Œå› ä¸ºå®ƒæœ€å®Œæ•´ï¼‰
   - åˆ é™¤`framework/beans`ï¼ˆä¸ioc-coreé‡å¤ï¼‰
   - å°†`core/src/main/java/com/dtc/core/framework/ioc/`ä¸­çš„ä¸‰çº§ç¼“å­˜ç­‰ä¼˜ç§€ç‰¹æ€§åˆå¹¶åˆ°`ioc-core`
   - åˆ é™¤`core`ä¸­çš„IoCå®ç°ï¼Œæ”¹ä¸ºä¾èµ–`ioc-core`

2. **ç»Ÿä¸€æ³¨è§£å®šä¹‰**
   - ç»Ÿä¸€ä½¿ç”¨`framework/annotations`ä¸­çš„æ³¨è§£
   - åˆ é™¤`core/src/main/java/com/dtc/core/framework/ioc/annotation/`ä¸­çš„é‡å¤æ³¨è§£
   - ç»Ÿä¸€å‘½åï¼ˆå»ºè®®ä½¿ç”¨`@Autowired`è€Œä¸æ˜¯`@Inject`ï¼Œæ›´ç¬¦åˆSpringä¹ æƒ¯ï¼‰

3. **æ¸…ç†ç©ºç›®å½•**
   - åˆ é™¤`framework/ioc-scanner/`å’Œ`framework/ioc-lifecycle/`ï¼Œæˆ–å¡«å……åŠŸèƒ½

### ä¼˜å…ˆçº§2ï¼ˆå»ºè®®ä¿®å¤ï¼‰

4. **ç»Ÿä¸€åŒ…åè§„èŒƒ**
   - å»ºè®®ç»Ÿä¸€ä½¿ç”¨`com.dtc.framework.ioc.*`ä½œä¸ºIoCç›¸å…³ç±»çš„åŒ…å

5. **ä¿®å¤ä¾èµ–å…³ç³»**
   - `core`æ¨¡å—åº”è¯¥åªä¾èµ–`ioc-core`ï¼Œä¸åº”è¯¥è‡ªå·±å®ç°IoC

6. **å®Œå–„AOPå®ç°**
   - æ£€æŸ¥å¹¶ä¿®å¤`AfterMethodInterceptor`ä¸­çš„ç±»å‹å¼•ç”¨é—®é¢˜

---

## ğŸ“Š ä»£ç é‡å¤ç»Ÿè®¡ï¼ˆä¼°ç®—ï¼‰

- **IoCæ ¸å¿ƒå®ç°**: ~80%é‡å¤
- **ApplicationContext**: 100%é‡å¤ï¼ˆ3ä¸ªç›¸åŒç±»åï¼‰
- **æ³¨è§£å®šä¹‰**: ~60%é‡å¤
- **æ€»ä½“é‡å¤ç‡**: çº¦70%

---

## âœ… ä¼˜ç‚¹

å°½ç®¡å­˜åœ¨é‡å¤ï¼Œä½†å„å®ç°éƒ½æœ‰äº®ç‚¹ï¼š
- `core/framework/ioc`: ä¸‰çº§ç¼“å­˜å®ç°ä¼˜é›…
- `framework/ioc-core`: åŠŸèƒ½æœ€å®Œæ•´ï¼ŒåŒ…å«Environmentã€BeanExpressionResolverç­‰
- `framework/aop`: AOPå®ç°ç»“æ„æ¸…æ™°

å»ºè®®å°†è¿™äº›ä¼˜ç‚¹åˆå¹¶åˆ°ç»Ÿä¸€å®ç°ä¸­ã€‚

